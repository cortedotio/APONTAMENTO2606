<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestão de Frotas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Leaflet CSS for Interactive Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      padding: 24px;
      background-color: #e0e7ff;
      display: flex;
      justify-content: center;
      align-items: center; /* Center vertically */
      min-height: 100vh;
    }
    .card {
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      width: 100%;
      max-width: 768px;
      background-color: #ffffff;
      border: 1px solid #e2e8f0;
      position: relative;
    }
    .header-actions {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        align-items: center;
        gap: 16px;
    }
    .alert-icon-wrapper {
        position: relative;
    }
    .alert-icon {
        color: #4a5568;
        cursor: pointer;
    }
    .alert-icon:hover {
        color: #1a202c;
    }
    .notification-dot {
        position: absolute;
        top: 0;
        right: 0;
        width: 8px;
        height: 8px;
        background-color: #ef4444;
        border-radius: 50%;
        display: none; /* Hidden by default */
    }
    h2 {
      font-size: 2.25rem;
      font-weight: 800;
      color: #1a202c;
      margin-bottom: 20px;
    }
    h3 {
      font-size: 1.75rem;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 2px solid #edf2f7;
    }
    h4 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 12px;
    }
    .btn {
      padding: 12px 28px;
      border: none;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      margin: 6px 4px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      background-image: linear-gradient(145deg, var(--color-light), var(--color-dark));
    }
    .btn.yellow { --color-light: #ffeb3b; --color-dark: #fbc02d; color: #333; }
    .btn.green { --color-light: #4CAF50; --color-dark: #388E3C; }
    .btn.red { --color-light: #f44336; --color-dark: #d32f2f; }
    .btn.blue { --color-light: #2196F3; --color-dark: #1976D2; }
    .btn.purple { --color-light: #9C27B0; --color-dark: #7B1FA2; }
    .btn.darkblue { --color-light: #3F51B5; --color-dark: #303F9F; }
    .btn.teal { --color-light: #009688; --color-dark: #00796B; }
    .btn.orange { --color-light: #FF9800; --color-dark: #F57C00; }
    /* Adicionado para botões escuros */
    .btn.dark-primary { --color-light: #374151; --color-dark: #1F2937; } /* Cor mais escura para botões principais */
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      opacity: 1;
    }
    .field {
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }
    @media (min-width: 640px) {
      .field {
        flex-direction: row;
        align-items: center;
        gap: 16px;
      }
    }
    .field label {
      flex: 0 0 140px;
      color: #4a5568;
      font-weight: 600;
      font-size: 0.95rem;
    }
    .field input[type="text"],
    .field input[type="date"],
    .field input[type="time"],
    .field input[type="password"],
    .field select,
    .field textarea {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid #cbd5e0;
      border-radius: 8px;
      box-sizing: border-box;
      width: 100%;
      font-size: 1rem;
      color: #2d3748;
      background-color: #f7fafc;
      transition: all 0.2s ease-in-out;
    }
    .field input:focus, .field select:focus, .field textarea:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
      background-color: #ffffff;
    }
    .field img {
      margin-left: 0;
      margin-top: 12px;
      width: 90px;
      height: 90px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #6366f1;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    @media (min-width: 640px) {
      .field img {
        margin-left: 20px;
        margin-top: 0;
      }
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    .checklist {
      padding: 20px;
      border: 1px solid #d1d8e0;
      border-radius: 12px;
      background-color: #f0f4f8;
      margin-top: 24px;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
    }
    .checklist h4 {
      color: #333;
      margin-top: 0;
      margin-bottom: 16px;
      text-align: center;
      font-size: 1.35rem;
    }
    .checklist label {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      font-size: 0.9rem;
      color: #4a5568;
    }
    .checklist input[type="radio"] {
        transform: scale(1.2);
        cursor: pointer;
    }
    .admin-panel {
      display: none;
      margin-top: 24px;
      padding-top: 20px;
      border-top: 1px solid #e2e8f0;
    }
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.6);
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(4px);
    }
    .modal-content {
        background-color: #ffffff;
        padding: 30px;
        border: 1px solid #b2c1d3;
        border-radius: 16px;
        width: 90%;
        max-width: 650px; /* Increased width for lists */
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        animation: fadeIn 0.3s ease-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .modal-warning-background {
        background-color: #ffebee;
        border-color: #ef9a9a;
    }
    .modal-warning-background h3,
    .modal-warning-background p {
        color: #c62828;
    }
    .modal-content h3 {
        font-size: 1.6rem;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 12px;
        border-bottom: none;
    }
    .modal-content p {
        font-size: 1.05rem;
        color: #555;
        margin-bottom: 24px;
        line-height: 1.5;
        white-space: pre-wrap; /* Allows line breaks in the message */
    }
    .modal-buttons button {
        margin: 0 10px;
        min-width: 100px;
    }
    .modal-list-content {
        max-height: 400px;
        overflow-y: auto;
        margin-top: 1rem;
    }
    .availability-table, .consult-table, .data-table {
        width: 100%;
        border-collapse: collapse;
        border-radius: 8px;
        overflow: hidden;
        margin-top: 16px;
    }
    .availability-table th, .availability-table td,
    .consult-table th, .consult-table td,
    .data-table th, .data-table td {
        padding: 12px 8px;
        font-size: 0.9rem;
        text-align: left;
        border: 1px solid #e2e8f0;
    }
    .availability-table thead, .consult-table thead, .data-table thead {
        background-color: #e2e8f0;
        color: #4a5568;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.8rem;
    }
    .availability-table tbody tr:nth-child(even),
    .consult-table tbody tr:nth-child(even),
    .data-table tbody tr:nth-child(even) {
        background-color: #f7fafc;
    }
    .availability-table tbody tr:hover,
    .consult-table tbody tr:hover,
    .data-table tbody tr:hover {
        background-color: #ebf4ff;
    }
    @media (max-width: 640px) {
        .availability-table, .consult-table, .data-table { border: none; }
        .availability-table thead, .consult-table thead, .data-table thead { display: none; }
        .availability-table tr, .consult-table tr, .data-table tr {
            margin-bottom: 16px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            background-color: #ffffff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            display: block;
            width: 100%;
        }
        .availability-table td, .consult-table td, .data-table td {
            border-bottom: 1px dotted #e2e8f0;
            text-align: right;
            padding-left: 50%;
            position: relative;
            display: block;
            white-space: normal;
            overflow: visible;
            text-overflow: clip;
        }
        .availability-table td:last-child, .consult-table td:last-child, .data-table td:last-child { border-bottom: 0; }
    }
    .status-maintenance-strong { background-color: #D32F2F; color: #FFFFFF; font-weight: 600; }
    .status-revision-strong { background-color: #3F51B5; color: #FFFFFF; font-weight: 600; }
    .status-active { background-color: #BBDEFB; color: #1A237E; font-weight: 600; }
    .status-cell {
        padding: 6px 12px;
        border-radius: 6px;
        display: inline-block;
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .status-ok { background-color: #c8e6c9; color: #2e7d32; }
    .status-inconsistente { background-color: #ffebee; color: #d32f2f; }
    #map { height: 400px; width: 100%; border-radius: 12px; }
    .loader {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255,255,255,0.7);
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .spinner {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #374151;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

<div id="loader" class="loader" style="display: none;"><div class="spinner"></div></div>

<!-- Painel de Login Principal -->
<div class="card" id="loginPanel">
    <div class="flex items-center gap-4 mb-4">
        <img id="logoLogin" alt="Logotipo da Empresa" class="h-14">
        <h2 class="flex-grow" style="margin-bottom: 0;">Acesso ao Sistema</h2>
    </div>
    <p class="text-gray-600 mb-8">Por favor, insira suas credenciais para continuar.</p>
    <div class="field">
        <label for="appUsername">Usuário (E-mail)</label>
        <input type="text" id="appUsername" required autocomplete="off">
    </div>
    <div class="field">
        <label for="appPassword">Senha</label>
        <input type="password" id="appPassword" required autocomplete="off">
    </div>
     <a href="#" id="passwordResetLink" class="text-sm text-indigo-600 hover:underline text-right block mb-4">Esqueci minha senha</a>
    <button id="mainLoginBtn" class="btn dark-primary w-full mt-4">Entrar</button>
</div>


<!-- Painel Principal de Gestão de Frotas -->
<div class="card" id="gestaoDeFrotasPanel" style="display:none;">
    <div class="header-actions">
        <div class="alert-icon-wrapper" id="alertIconWrapper">
            <svg class="w-6 h-6 alert-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
            </svg>
            <span id="notification-dot" class="notification-dot"></span>
        </div>
        <button id="logoutBtn" class="btn dark-primary !p-2 !m-0">Sair</button>
    </div>
    <div class="flex items-center gap-4 mb-4">
        <img id="logoGestao" alt="Logotipo da Empresa" class="h-14">
        <h2 class="flex-grow" style="margin-bottom: 0;">Gestão de Frotas</h2>
    </div>
    <p class="text-gray-600 mb-8">Selecione uma das opções abaixo para gerenciar a frota de empilhadeiras.</p>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
        <button id="btnShowStatus" class="btn dark-primary">Status de Atividade</button>
        <button id="btnShowMaintenance" class="btn dark-primary">Gestão de Manutenção</button>
        <button id="btnShowFueling" class="btn dark-primary">Gestão de Abastecimento</button>
        <button id="btnShowLocation" class="btn dark-primary">Localização</button>
        <button id="btnShowTires" class="btn dark-primary">Gestão de Pneus</button>
        <button id="btnShowRegister" class="btn dark-primary">Cadastro</button>
        <button id="btnShowReport" class="btn dark-primary">Relatório</button>
    </div>
    <div class="flex justify-center mt-4">
        <button class="btn dark-primary" id="managementButton">Gerenciamento</button>
    </div>
</div>

<!-- Location Panel -->
<div class="card" id="localizacaoPanel" style="display:none;">
    <div class="flex justify-between items-center mb-6">
        <h3>Localização de Frotas</h3>
        <button id="btnBackFromLocation" class="btn dark-primary">Voltar</button>
    </div>
    <div id="map"></div>
</div>


<!-- Painel da Aplicação de Atividade de Empilhadeiras (oculto por padrão) -->
<div class="card" id="statusDeAtividadePanel" style="display:none;">
  <div class="flex justify-between items-center mb-6">
    <div class="flex items-center gap-4">
        <img id="logoStatus" alt="Logotipo da Empresa" class="h-14">
        <h2 id="panelTitle" style="margin-bottom: 0;">Status de Atividade</h2>
    </div>
    <div>
        <button id="btnBackFromStatus" class="btn dark-primary">Voltar</button>
    </div>
  </div>
  
  <div class="flex flex-wrap justify-center mb-8 gap-3">
    <button class="btn yellow" id="btnDisponibilidade">Disponibilidade</button>
    <button class="btn green" id="btnInicioAtividade">Início de Atividade</button>
    <button class="btn red" id="btnEncerramentoAtividade">Encerramento de Atividade</button>
    <button class="btn dark-primary" id="btnCadastro" style="display:none;">Cadastro</button>
    <button class="btn dark-primary" id="btnRelatorio" style="display:none;">Relatório</button>
    <button class="btn dark-primary" id="btnDados" style="display:none;">Dados</button>
  </div>
  
  <div id="inicio" style="display:none; margin-top:20px; background-color: #f0fff4; padding: 20px; border-radius: 12px;">
    <h3>Início de Atividade</h3>
    <form id="formInicio">
      <div class="flex justify-end mb-4">
        <button id="btnClearFormInicio" class="btn dark-primary" type="button">Limpar Formulário</button>
      </div>
      <div class="field">
        <label for="crachaInicio">Crachá</label>
        <input type="text" name="crachaInicio" id="crachaInicio" required>
        <label for="nomeInicio">Operador</label>
        <input type="text" id="nomeInicio" readonly>
        <img id="fotoInicio" src="https://placehold.co/100x100/A0AEC0/000000?text=OPERADOR" alt="Foto Operador">
      </div>
      <div class="field">
        <label for="dataInicial">Data Inicial</label>
        <input type="date" name="dataInicial" id="dataInicial" required>
      </div>
      <div class="field">
        <label for="horaInicial">Hora Inicial</label>
        <input type="time" id="horaInicial" name="horaInicial" required>
      </div>
      <div class="field">
        <label for="frotaInicio">Frota</label>
        <input type="text" name="frotaInicio" id="frotaInicio" required>
        <img id="fotoEquipInicio" src="https://placehold.co/100x100/A0AEC0/000000?text=FROTA" alt="Foto Frota">
      </div>
      <div class="field">
        <label for="equipamentoInicio">Equipamento</label>
        <input type="text" id="equipamentoInicio" readonly>
      </div>
      <div class="field">
        <label for="horimetroInicial">Horímetro Inicial</label>
        <input type="text" name="horimetroInicial" id="horimetroInicial" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" required>
      </div>
      <div class="field">
        <label for="setorInicio">Setor</label>
        <select id="setorInicio" required></select>
      </div>
      <div class="field">
        <label for="atividadeInicio">Atividade</label>
        <select id="atividadeInicio" required></select>
      </div>
      <div class="field" id="relatoProblemaField" style="display:none;">
        <label for="relatoProblema">Relato do Problema</label>
        <textarea name="relatoProblema" id="relatoProblema" rows="3" placeholder="Descreva o problema da manutenção"></textarea>
      </div>
      <div class="field">
        <label for="implementoInicio">Implemento</label>
        <select id="implementoInicio" required></select>
      </div>
      <div class="checklist" id="safetyChecklist">
        <h4 class="font-bold uppercase text-center mb-4">Checklist de Segurança</h4>
        <div class="grid grid-cols-12 gap-2 items-center text-center font-bold text-gray-700 text-sm mb-2">
            <div class="col-span-1">OK</div>
            <div id="hideChecklistReports" class="col-span-6 text-left cursor-pointer">ITENS A CONFERIR</div>
            <div class="col-span-2">NÃO CONFORME</div>
            <div class="col-span-3 text-left">RELATAR</div>
        </div>
        <div class="grid grid-cols-12 gap-2 items-center mb-3">
            <div class="col-span-1 flex justify-center"><input type="radio" name="status_OleoMotor" value="OK" checked required></div>
            <div class="col-span-6 text-left text-sm">Óleo do Motor</div>
            <div class="col-span-2 flex justify-center"><input type="radio" name="status_OleoMotor" value="NÃO CONFORME" data-target-textarea="relato_OleoMotor"></div>
            <div class="col-span-3"><textarea name="relato_OleoMotor" id="relato_OleoMotor" rows="1" placeholder="Relatar não conformidade" class="hidden text-xs px-1 py-0.5 w-full border rounded"></textarea></div>
        </div>
        <div class="grid grid-cols-12 gap-2 items-center mb-3">
            <div class="col-span-1 flex justify-center"><input type="radio" name="status_OleoHidraulico" value="OK" checked required></div>
            <div class="col-span-6 text-left text-sm">Óleo Hidráulico</div>
            <div class="col-span-2 flex justify-center"><input type="radio" name="status_OleoHidraulico" value="NÃO CONFORME" data-target-textarea="relato_OleoHidraulico"></div>
            <div class="col-span-3"><textarea name="relato_OleoHidraulico" id="relato_OleoHidraulico" rows="1" placeholder="Relatar não conformidade" class="hidden text-xs px-1 py-0.5 w-full border rounded"></textarea></div>
        </div>
        <div class="grid grid-cols-12 gap-2 items-center mb-3">
            <div class="col-span-1 flex justify-center"><input type="radio" name="status_OleoTransmissao" value="OK" checked required></div>
            <div class="col-span-6 text-left text-sm">Óleo da Transmissão</div>
            <div class="col-span-2 flex justify-center"><input type="radio" name="status_OleoTransmissao" value="NÃO CONFORME" data-target-textarea="relato_OleoTransmissao"></div>
            <div class="col-span-3"><textarea name="relato_OleoTransmissao" id="relato_OleoTransmissao" rows="1" placeholder="Relatar não conformidade" class="hidden text-xs px-1 py-0.5 w-full border rounded"></textarea></div>
        </div>
        <div class="grid grid-cols-12 gap-2 items-center mb-3">
            <div class="col-span-1 flex justify-center"><input type="radio" name="status_Extintor" value="OK" checked required></div>
            <div class="col-span-6 text-left text-sm">Extintor</div>
            <div class="col-span-2 flex justify-center"><input type="radio" name="status_Extintor" value="NÃO CONFORME" data-target-textarea="relato_Extintor"></div>
            <div class="col-span-3"><textarea name="relato_Extintor" id="relato_Extintor" rows="1" placeholder="Relatar não conformidade" class="hidden text-xs px-1 py-0.5 w-full border rounded"></textarea></div>
        </div>
        <div class="grid grid-cols-12 gap-2 items-center mb-3">
            <div class="col-span-1 flex justify-center"><input type="radio" name="status_Pneus" value="OK" checked required></div>
            <div class="col-span-6 text-left text-sm">Pneus</div>
            <div class="col-span-2 flex justify-center"><input type="radio" name="status_Pneus" value="NÃO CONFORME" data-target-textarea="relato_Pneus"></div>
            <div class="col-span-3"><textarea name="relato_Pneus" id="relato_Pneus" rows="1" placeholder="Relatar não conformidade" class="hidden text-xs px-1 py-0.5 w-full border rounded"></textarea></div>
        </div>
        <div class="grid grid-cols-12 gap-2 items-center mb-3">
            <div class="col-span-1 flex justify-center"><input type="radio" name="status_ParteEletrica" value="OK" checked required></div>
            <div class="col-span-6 text-left text-sm">Parte Elétrica</div>
            <div class="col-span-2 flex justify-center"><input type="radio" name="status_ParteEletrica" value="NÃO CONFORME" data-target-textarea="relato_ParteEletrica"></div>
            <div class="col-span-3"><textarea name="relato_ParteEletrica" id="relato_ParteEletrica" rows="1" placeholder="Relatar não conformidade" class="hidden text-xs px-1 py-0.5 w-full border rounded"></textarea></div>
        </div>
      </div>
      <button id="btnEnviarInicio" class="btn dark-primary mt-6" type="button">Salvar Início</button>
    </form>
  </div>
  
  <div id="disponibilidade" style="display:none; margin-top:20px; background-color: #fffbeb; padding: 20px; border-radius: 12px;">
    <h3>Disponibilidade</h3>
    <div id="disponibilidadeContent"><p class="text-gray-600">Nenhuma frota cadastrada ou atividade em andamento para exibir.</p></div>
    <div id="frotasEmManutencaoList" class="mt-8 p-6 border border-red-300 rounded-lg bg-red-50 shadow-md" style="display: none;">
      <h4 class="text-xl font-bold mb-4 text-red-700">Frotas em Manutenção</h4>
      <ul id="manutencaoItems" class="list-disc pl-5 text-red-600 text-base leading-relaxed"></ul>
    </div>
  </div>
  
  <div id="fim" style="display:none; margin-top:20px; background-color: #ebf8ff; padding: 20px; border-radius: 12px;">
    <h3>Fim de Atividade</h3>
    <form id="formFim">
      <div class="flex justify-end mb-4"><button id="btnClearFormFim" class="btn dark-primary" type="button">Limpar Formulário</button></div>
      <div class="field">
        <label for="crachaFim">Crachá</label>
        <input type="text" name="crachaFim" id="crachaFim" required>
        <label for="nomeFim">Operador</label>
        <input type="text" id="nomeFim" readonly>
        <img id="fotoFim" src="https://placehold.co/100x100/A0AEC0/000000?text=OPERADOR" alt="Foto Operador">
      </div>
      <div class="field">
        <label for="dataFinal">Data Final</label>
        <input type="date" name="dataFinal" id="dataFinal" required>
      </div>
      <div class="field">
        <label for="horaFinal">Hora Final</label>
        <input type="time" id="horaFinal" name="horaFinal" required>
      </div>
      <div class="field">
        <label for="frotaFim">Frota</label>
        <input type="text" name="frotaFim" id="frotaFim" required>
        <img id="fotoEquipFim" src="https://placehold.co/100x100/A0AEC0/000000?text=FROTA" alt="Foto Frota">
      </div>
      <div class="field" id="frotaSelectionContainer" style="display:none;">
          <label for="selectFrotaAtiva">Selecione a Frota:</label>
          <div id="multipleFrotaWarning" class="text-red-700 font-semibold mb-2" style="display:none;"></div>
          <select id="selectFrotaAtiva"></select>
      </div>
      <div class="field">
        <label for="equipamentoFim">Equipamento</label>
        <input type="text" id="equipamentoFim" readonly>
      </div>
      <div class="field">
        <label for="horimetroFim">Horímetro Final</label>
        <input type="text" name="horimetroFim" id="horimetroFim" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" required>
      </div>
      <div class="field">
        <label for="observacoesFim">Observações</label>
        <textarea name="observacoesFim" id="observacoesFim" rows="3"></textarea>
      </div>
      <button id="btnEnviarFim" class="btn dark-primary mt-6" type="button">Finalizar</button>
    </form>
  </div>
  
  <div id="cadastro" class="admin-panel">
    <h3>Cadastro</h3> 
    <div class="flex flex-wrap justify-center mb-6 gap-3">
      <button id="btnShowCadastroOperador" class="btn dark-primary">Operador</button>
      <button id="btnShowCadastroFrota" class="btn dark-primary">Frota</button>
      <button id="btnShowCadastroSetor" class="btn dark-primary">Setor</button>
      <button id="btnShowCadastroAtividade" class="btn dark-primary">Atividade</button>
      <button id="btnShowCadastroImplemento" class="btn dark-primary">Implemento</button>
    </div>
    <div id="cadastroOperador" style="display:none; margin-top:10px;">
      <h4>Cadastro de Operador</h4>
      <form><div class="field"><label for="crachaOperador">Crachá</label><input type="text" id="crachaOperador" oninput="this.value = this.value.toUpperCase()"></div>
      <div class="field"><label for="nomeOperador">Operador</label><input type="text" id="nomeOperador" oninput="this.value = this.value.toUpperCase()"></div>
      <div class="field"><label for="fotoOperador">Foto</label><input type="file" id="fotoOperador" accept="image/*" capture></div>
      <div class="flex justify-start gap-4 mt-6"><button id="btnSalvarOperador" class="btn dark-primary" type="button">Salvar</button><button id="btnConsultarOperador" class="btn dark-primary" type="button">Consultar</button></div></form>
    </div>
    <div id="cadastroFrota" style="display:none; margin-top:10px;">
      <h4>Cadastro de Frota</h4>
      <form><div class="field"><label for="codigoFrota">Frota</label><input type="text" id="codigoFrota" oninput="this.value = this.value.toUpperCase()"></div>
      <div class="field"><label for="modeloFrota">Modelo</label><input type="text" id="modeloFrota" oninput="this.value = this.value.toUpperCase()"></div>
      <div class="field"><label for="fotoFrota">Foto</label><input type="file" id="fotoFrota" accept="image/*" capture></div>
      <div class="flex justify-start gap-4 mt-6"><button id="btnSalvarFrota" class="btn dark-primary" type="button">Salvar</button><button id="btnConsultarFrota" class="btn dark-primary" type="button">Consultar</button></div></form>
    </div>
    <div id="cadastroSetor" style="display:none; margin-top:10px;">
      <h4>Cadastro de Setor</h4>
      <div class="field"><label for="nomeSetor">Setor</label><input type="text" id="nomeSetor" oninput="this.value = this.value.toUpperCase()"></div>
      <div class="flex justify-start gap-4 mt-6"><button id="btnSalvarSetor" class="btn dark-primary">Salvar</button><button id="btnConsultarSetor" class="btn dark-primary">Consultar</button></div>
    </div>
    <div id="cadastroAtividade" style="display:none; margin-top:10px;">
      <h4>Cadastro de Atividade</h4>
      <div class="field"><label for="nomeAtividade">Atividade</label><input type="text" id="nomeAtividade" oninput="this.value = this.value.toUpperCase()"></div>
      <div class="flex justify-start gap-4 mt-6"><button id="btnSalvarAtividade" class="btn dark-primary" type="button">Salvar</button><button id="btnConsultarAtividade" class="btn dark-primary" type="button">Consultar</button></div></form>
    </div>
    <div id="cadastroImplemento" style="display:none; margin-top:10px;">
      <h4>Cadastro de Implemento</h4>
      <div class="field"><label for="nomeImplemento">Implemento</label><input type="text" id="nomeImplemento" oninput="this.value = this.value.toUpperCase()"></div>
      <div class="field"><label for="siglaImplemento">Sigla</label><input type="text" id="siglaImplemento" required oninput="this.value = this.value.toUpperCase()"></div>
      <div class="flex justify-start gap-4 mt-6"><button id="btnSalvarImplemento" class="btn dark-primary">Salvar</button><button id="btnConsultarImplemento" class="btn dark-primary" type="button">Consultar</button></div>
    </div>
  </div>

  <div id="administrador" class="admin-panel">
    <h3>Painel Administrativo</h3>
    <div id="adminDashboard" style="display:none; margin-top:20px;">
      <h4>Bem-vindo, <span id="loggedInUserRoleDisplay"></span>!</h4>
      <p class="mb-4 text-gray-700">Você está logado com acesso <span id="loggedInUserLevelDisplay" class="font-bold"></span>.</p>
      <div id="userManagement" class="mt-8 p-6 border border-blue-300 rounded-lg bg-blue-50 shadow-md" style="display: none;">
        <h4 class="text-xl font-bold mb-4 text-blue-800">Gerenciamento de Usuários</h4>
        <div class="field"><label for="newUsername">Usuário (E-mail)</label><input type="text" id="newUsername" placeholder="Novo usuário" required></div>
        <div class="field"><label for="newPassword">Senha</label><input type="password" id="newPassword" placeholder="Nova senha" required></div>
        <div class="field">
          <label for="newUserLevel">Nível</label>
          <select id="newUserLevel" required>
            <option value="">Selecione o Nível</option>
            <option value="analista">Analista</option>
            <option value="administrador">Administrador</option>
          </select>
        </div>
        <button id="btnSalvarUsuario" class="btn dark-primary mt-6">Salvar Usuário</button>
        <h5 class="font-bold mt-8 mb-4 text-gray-700">Usuários Cadastrados:</h5>
        <div id="userListContainer" class="max-h-60 overflow-y-auto border border-gray-200 rounded-lg bg-white shadow-inner">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuário</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nível</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
              </tr>
            </thead>
            <tbody id="userList" class="bg-white divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div id="relatorio" style="display:none; margin-top:20px;">
    <h3>Relatórios</h3>
    <div class="field">
        <label for="tipoRelatorio">Tipo de Relatório</label>
        <select id="tipoRelatorio">
            <option value="horasFrota">Horas por Frota</option>
            <option value="atividadesOperador">Atividades por Operador</option>
            <option value="manutencoes">Manutenções</option>
            <option value="disponibilidade">Tempo de Disponibilidade de Frotas</option>
            <option value="comparativoHoras">Horímetro vs. Apontamento</option>
            <option value="atividades">Relatório de Atividades</option>
            <option value="setor">Relatório por Setor</option>
            <option value="edicoes">Relatório de Apontamentos Inconsistentes</option>
            <option value="consumoFrota">Consumo por Frota</option>
            <option value="custosCombustivel">Custos de Combustível</option>
            <option value="custosManutencao">Custos de Manutenção</option>
        </select>
    </div>
    <div class="field">
      <label for="relatorioDataInicio">Data de Início</label>
      <input type="date" id="relatorioDataInicio">
    </div>
    <div class="field">
      <label for="relatorioDataFim">Data de Fim</label>
      <input type="date" id="relatorioDataFim">
    </div>
    <button id="btnGerarRelatorio" class="btn dark-primary mt-4">Gerar Relatório</button>
    <!-- Botão Dados movido para cá -->
    <button id="btnShowDadosRelatorio" class="btn dark-primary mt-4">Dados</button>
    <div id="relatorioResultado" class="mt-6"></div>
  </div>

  <div id="dados" style="display:none; margin-top:20px;">
    <h3>Banco de Dados de Lançamentos</h3>
    <p class="text-gray-600 mb-4">Visualize e gerencie todos os lançamentos históricos. Alterações requerem senha de administrador.</p>
    <div id="dadosContent" class="mt-4"></div>
  </div>
</div>

<!-- Maintenance Panel -->
<div class="card" id="manutencaoPanel" style="display:none;">
    <div class="flex justify-between items-center mb-6">
        <h3>Gestão de Manutenção</h3>
        <button id="btnBackFromMaintenance" class="btn dark-primary">Voltar</button>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
        <button class="btn dark-primary" onclick="window.mostrarManutencaoSubpanel('formAbrirOS')">Abrir Ordem de Serviço</button>
        <button class="btn dark-primary" onclick="window.mostrarManutencaoSubpanel('formPlanosManutencao')">Planos de Manutenção</button>
        <button class="btn dark-primary" onclick="window.mostrarManutencaoSubpanel('consultarOS')">Consultar Ordens de Serviço</button>
        <button class="btn dark-primary" onclick="window.mostrarManutencaoSubpanel('gestaoPecas')">Gestão de Peças</button>
        <button class="btn dark-primary" onclick="window.mostrarManutencaoSubpanel('orcamentosAprovacoes')">Orçamentos e Aprovações</button>
        <button class="btn dark-primary" onclick="window.mostrarManutencaoSubpanel('historicoManutencao')">Histórico de Manutenção</button>
    </div>

    <div id="formAbrirOS" style="display:none;">
        <h4>Abrir Ordem de Serviço</h4>
        <form id="osForm">
            <div class="field"><label for="osFrota">Frota</label><input type="text" id="osFrota" oninput="this.value = this.value.toUpperCase(); window.mostrarModeloFrota(this.value, 'osModelo')" required><input type="text" id="osModelo" readonly placeholder="Modelo"></div>
            <div class="field"><label for="osDataAbertura">Data Abertura</label><input type="text" id="osDataAbertura" readonly></div>
            <div class="field"><label for="osSolicitante">Solicitante</label><input type="text" id="osSolicitante" required></div>
            <div class="field"><label for="osDescricao">Descrição do Problema</label><textarea id="osDescricao" rows="3" required></textarea></div>
            <div class="field"><label for="osTipo">Tipo</label><select id="osTipo"><option value="Corretiva">Corretiva</option><option value="Preventiva">Preventiva</option></select></div>
            <button class="btn dark-primary mt-4" type="button" onclick="window.salvarOS()">Abrir OS</button>
        </form>
    </div>
    <div id="formPlanosManutencao" style="display:none;">
        <h4>Planos de Manutenção</h4>
        <form id="planosManutencaoForm">
            <div class="field"><label for="planoFrota">Frota</label><input type="text" id="planoFrota" oninput="this.value = this.value.toUpperCase(); window.mostrarModeloFrota(this.value, 'planoModelo')" required><input type="text" id="planoModelo" readonly placeholder="Modelo"></div>
            <div class="field"><label for="planoDescricao">Descrição</label><textarea id="planoDescricao" rows="2" required></textarea></div>
            <div class="field"><label for="tipoManutencao">Tipo</label><select id="tipoManutencao" required><option value="Horímetro">Baseado em Horímetro</option><option value="Tempo">Baseado em Tempo</option></select></div>
            <div class="field" id="horimetroIntervalField"><label for="horimetroInterval">Intervalo (Horímetro)</label><input type="text" id="horimetroInterval" oninput="this.value = this.value.replace(/[^0-9.]/g, '')"></div>
            <div class="field" id="tempoIntervalField" style="display:none;"><label for="tempoInterval">Intervalo (dias)</label><input type="text" id="tempoInterval" oninput="this.value = this.value.replace(/[^0-9]/g, '')"></div>
            <div class="field"><label for="ultimaManutencao">Última Manutenção</label><input type="date" id="ultimaManutencao"></div>
            <button class="btn dark-primary mt-4" type="button" onclick="window.salvarPlanoManutencao()">Salvar Plano</button>
        </form>
        <div id="planosManutencaoListContainer" class="mt-6">
            <h4>Planos Cadastrados</h4>
            <div id="planosManutencaoTable"></div>
        </div>
    </div>
    <div id="consultarOS" style="display:none;">
        <h4>Consultar Ordens de Serviço</h4>
        <div id="osListContainer">
            <p class="text-gray-600">Nenhuma Ordem de Serviço para exibir.</p>
        </div>
    </div>
    <div id="gestaoPecas" style="display:none;">
        <h4>Gestão de Peças</h4>
        <form id="pecaForm">
            <div class="field"><label for="nomePeca">Nome da Peça</label><input type="text" id="nomePeca" required></div>
            <div class="field"><label for="codPeca">Cód. Peça</label><input type="text" id="codPeca"></div>
            <div class="field"><label for="stockPeca">Stock</label><input type="number" id="stockPeca" required min="0"></div>
            <div class="field"><label for="minStockPeca">Stock Mínimo</label><input type="number" id="minStockPeca" min="0"></div>
            <div class="field"><label for="custoPeca">Custo Unitário (R$)</label><input type="text" id="custoPeca" oninput="this.value = this.value.replace(/[^0-9.]/g, '')"></div>
            <button class="btn dark-primary mt-4" type="button" onclick="window.salvarPeca()">Salvar Peça</button>
        </form>
        <div id="pecasListContainer" class="mt-6">
            <h4>Inventário de Peças</h4>
            <div id="pecasTable"></div>
        </div>
    </div>
    <div id="orcamentosAprovacoes" style="display:none;">
        <h4>Orçamentos e Aprovações</h4>
        <form id="orcamentoForm">
            <div class="field"><label for="orcamentoOsId">OS ID</label><input type="text" id="orcamentoOsId" oninput="this.value = this.value.replace(/[^0-9]/g, '')" required></div>
            <div class="field"><label for="orcamentoDescricao">Descrição Orçamento</label><textarea id="orcamentoDescricao" rows="2"></textarea></div>
            <div class="field"><label for="orcamentoValor">Valor Estimado (R$)</label><input type="text" id="orcamentoValor" oninput="this.value = this.value.replace(/[^0-9.]/g, '')" required></div>
            <button class="btn dark-primary mt-4" type="button" onclick="window.salvarOrcamento()">Submeter Orçamento</button>
        </form>
        <div id="orcamentosListContainer" class="mt-6">
            <h4>Orçamentos Pendentes</h4>
            <div id="orcamentosTable"></div>
        </div>
    </div>
    <div id="historicoManutencao" style="display:none;">
        <h4>Histórico de Manutenção</h4>
        <div class="field"><label for="historicoFrotaFilter">Filtrar por Frota</label><input type="text" id="historicoFrotaFilter" oninput="this.value = this.value.toUpperCase(); window.consultarHistoricoManutencao()"></div>
        <div id="historicoManutencaoListContainer" class="mt-4">
            <p class="text-gray-600">Nenhum histórico de manutenção para exibir.</p>
        </div>
    </div>
</div>


<!-- Fueling Panel -->
<div class="card" id="abastecimentoPanel" style="display:none;">
    <div class="flex justify-between items-center mb-6">
        <h3>Gestão de Abastecimento</h3>
        <button class="btn dark-primary" onclick="window.showApp('gestaoDeFrotasPanel')">Voltar</button>
    </div>
    <div class="flex flex-wrap justify-center mb-6 gap-3">
      <button class="btn dark-primary" onclick="window.mostrarAbastecimentoSubpanel('formAbastecimento')">Registrar Abastecimento</button>
      <button class="btn dark-primary" onclick="window.mostrarAbastecimentoSubpanel('formCompraCombustivel')">Registrar Compra de Combustível</button>
    </div>
    <div id="formAbastecimento" style="display:none;">
        <h4>Registrar Abastecimento</h4>
        <form id="abastecimentoForm">
            <div class="field"><label for="abastecimentoFrota">Frota</label><input type="text" id="abastecimentoFrota" oninput="this.value = this.value.toUpperCase(); window.mostrarModeloFrota(this.value, 'abastecimentoModelo')" required><input type="text" id="abastecimentoModelo" readonly placeholder="Modelo"></div>
            <div class="field"><label for="abastecimentoDoc">Documento/NF</label><input type="text" id="abastecimentoDoc" required></div>
            <div class="field"><label for="abastecimentoEmpresa">Empresa</label><input type="text" id="abastecimentoEmpresa" required></div>
            <div class="field"><label for="abastecimentoHorimetro">Horímetro</label><input type="text" id="abastecimentoHorimetro" oninput="this.value = this.value.replace(/[^0-9.]/g, '')" required></div>
            <div class="field"><label for="abastecimentoData">Data</label><input type="date" id="abastecimentoData" required></div>
            <div class="field"><label for="abastecimentoHora">Hora</label><input type="time" id="abastecimentoHora" required></div>
            <div class="field"><label for="abastecimentoMotorista">Crachá Motorista</label><input type="text" id="abastecimentoMotorista" oninput="this.value = this.value.toUpperCase(); window.buscarOperador(this.value, 'nomeMotorista')" required><input type="text" id="nomeMotorista" readonly placeholder="Nome do Motorista"></div>
            <div class="field"><label for="abastecimentoFrentista">Crachá Frentista</label><input type="text" id="abastecimentoFrentista" oninput="this.value = this.value.toUpperCase(); window.buscarOperador(this.value, 'nomeFrentista')" required><input type="text" id="nomeFrentista" readonly placeholder="Nome do Frentista"></div>
            <div class="field"><label for="abastecimentoCodProduto">Cód. Produto</label><input type="text" id="abastecimentoCodProduto" oninput="this.value = this.value.toUpperCase(); window.buscarProduto(this.value, 'nomeProduto')" required><input type="text" id="nomeProduto" readonly placeholder="Nome do Produto"></div>
            <div class="field"><label for="abastecimentoLocal">Local</label><select id="abastecimentoLocal" onchange="window.toggleVolumeRestante(this.value)"><option value="interno">Dentro da Empresa</option><option value="externo">Fora da Empresa</option></select></div>
            <div class="field" id="volumeRestanteField"><label for="volumeRestante">Volume Restante</label><input type="text" id="volumeRestante" readonly></div>
            <button class="btn dark-primary mt-4" type="button" onclick="window.salvarAbastecimento()">Salvar</button>
        </form>
    </div>
    <div id="formCompraCombustivel" style="display:none;">
        <h4>Registrar Compra de Combustível</h4>
        <form id="compraCombustivelForm">
            <div class="field"><label for="compraCodProduto">Cód. Produto</label><input type="text" id="compraCodProduto" oninput="this.value = this.value.toUpperCase();" required></div>
            <div class="field"><label for="compraEmpresa">Empresa Comprado</label><input type="text" id="compraEmpresa" required></div>
            <div class="field"><label for="compraVolume">Volume (L)</label><input type="text" id="compraVolume" oninput="this.value = this.value.replace(/[^0-9.]/g, '')" required></div>
            <div class="field"><label for="compraValor">Valor (R$)</label><input type="text" id="compraValor" oninput="this.value = this.value.replace(/[^0-9.]/g, '')" required></div>
            <button class="btn dark-primary mt-4" type="button" onclick="window.salvarCompraCombustivel()">Salvar Compra</button>
        </form>
    </div>
</div>

<!-- Tires Panel -->
<div class="card" id="pneusPanel" style="display:none;">
    <div class="flex justify-between items-center mb-6">
        <h3>Gestão de Pneus</h3>
        <button class="btn dark-primary" onclick="window.showApp('gestaoDeFrotasPanel')">Voltar</button>
    </div>
    <p class="text-gray-600 mb-8">Esta seção está em desenvolvimento.</p>
</div>

<!-- Confirmation Modal -->
<div id="confirmationModal" class="modal">
    <div class="modal-content" id="modalContent">
        <h3 id="modalTitle">Confirmação</h3>
        <p id="modalMessage">Você tem certeza?</p>
        <div class="modal-buttons">
            <button id="modalConfirmBtn" class="btn dark-primary">Confirmar</button>
            <button id="modalCancelBtn" class="btn dark-primary">Cancelar</button>
        </div>
    </div>
</div>

<!-- List Display Modal -->
<div id="listModal" class="modal">
    <div class="modal-content">
        <h3 id="listModalTitle">Itens Cadastrados</h3>
        <div id="listModalContent" class="modal-list-content"></div>
        <div class="modal-buttons mt-4">
            <button id="listModalCloseBtn" class="btn dark-primary">Fechar</button>
        </div>
    </div>
</div>

<!-- Generic Edit Modal -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <h3 id="editModalTitle">Editar Item</h3>
        <form id="editForm" class="text-left"></form>
        <div class="modal-buttons mt-6">
            <button id="editModalSaveBtn" class="btn dark-primary">Salvar</button>
            <button id="editModalCancelBtn" class="btn dark-primary">Cancelar</button>
        </div>
    </div>
</div>

<!-- Alert Modal -->
<div id="alertModal" class="modal">
    <div class="modal-content">
        <h3 id="alertModalTitle">Alertas e Notificações</h3>
        <div id="alertModalContent" class="modal-list-content text-left"></div>
        <div class="modal-buttons mt-4">
            <button class="btn dark-primary" onclick="document.getElementById('alertModal').style.display = 'none'">Fechar</button>
        </div>
    </div>
</div>

<!-- Leaflet JS for Interactive Map -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<!-- Firebase SDKs -->
<script type="module">
  // Import the functions you need from the SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, collection, getDocs, deleteDoc, addDoc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBcGZ7GXAbYTPg2YZjtpuCMdmSv4ue7Q8Q",
    authDomain: "gestaodefrotasapp-4f48f.firebaseapp.com",
    projectId: "gestaodefrotasapp-4f48f",
    storageBucket: "gestaodefrotasapp-4f48f.appspot.com",
    messagingSenderId: "105185091527",
    appId: "1:105185091527:web:1cbb47dcf8f9e3c56c83e2"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Make Firebase functions globally available
  window.auth = auth;
  window.db = db;
  window.doc = doc;
  window.setDoc = setDoc;
  window.getDoc = getDoc;
  window.collection = collection;
  window.getDocs = getDocs;
  window.deleteDoc = deleteDoc;
  window.addDoc = addDoc;
  window.query = query;
  window.where = where;
  window.onSnapshot = onSnapshot;
  window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
  window.signInWithEmailAndPassword = signInWithEmailAndPassword;
  window.signOut = signOut;
  window.onAuthStateChanged = onAuthStateChanged;
  window.sendPasswordResetEmail = sendPasswordResetEmail;
  
  // --- O restante do seu código JavaScript virá aqui ---
</script>
</body>
</html>
